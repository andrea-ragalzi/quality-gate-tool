@use "sass:math";
@use "sass:color";
@use "./variables" as vars;

// CRT Monitor Effect - Scanlines + Phosphor Glow + Chromatic Aberration
@mixin crt-screen {
  position: relative;

  &::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: vars.$z-scanlines;

    // Match preview.html scanlines (4px pattern)
    background: linear-gradient(
      to bottom,
      rgba(255, 255, 255, 0),
      rgba(255, 255, 255, 0) 50%,
      rgba(0, 0, 0, 0.2) 50%,
      rgba(0, 0, 0, 0.2)
    );
    background-size: 100% 4px;
    opacity: 0.3;
  }
}

@keyframes crt-flicker {
  0% {
    opacity: 0.95;
  }
  100% {
    opacity: 0.98;
  }
}

@keyframes crt-scan {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 0 100%;
  }
}

@keyframes phosphor-glow {
  0% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    opacity: 0.3;
  }
}

// Text glow effect
@mixin text-glow($color: vars.$matrix-green, $intensity: 0.75rem) {
  text-shadow:
    0 0 math.div($intensity, 4) $color,
    0 0 math.div($intensity, 2) $color,
    0 0 $intensity $color,
    0 0 $intensity * 2 rgba($color, 0.5);
  color: $color;
}

// Box glow effect
@mixin box-glow($color: vars.$matrix-green, $intensity: 1.5rem) {
  box-shadow:
    0 0 math.div($intensity, 4) $color,
    0 0 math.div($intensity, 2) $color,
    0 0 $intensity $color,
    inset 0 0 math.div($intensity, 2) rgba($color, 0.2);
  border: 2px solid $color;
}

// Glitch effect
@mixin glitch-text {
  position: relative;
  animation: glitch-skew 0.5s infinite;

  &::before,
  &::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  &::before {
    left: 2px;
    text-shadow: -2px 0 vars.$matrix-red;
    clip: rect(3.25rem, 32.25rem, 4rem, 0);
    animation: glitch-anim 5s infinite linear alternate-reverse;
  }

  &::after {
    left: -2px;
    text-shadow: -2px 0 vars.$matrix-cyan;
    clip: rect(3.25rem, 32.25rem, 4rem, 0);
    animation: glitch-anim 3s infinite linear alternate-reverse;
  }
}

@keyframes glitch-anim {
  0% {
    clip: rect(0.75rem, 714.25rem, 2.25rem, 0);
  }
  5% {
    clip: rect(5rem, 714.25rem, 5rem, 0);
  }
  10% {
    clip: rect(4.25rem, 714.25rem, 4.75rem, 0);
  }
  15% {
    clip: rect(6.25rem, 714.25rem, 3rem, 0);
  }
  20% {
    clip: rect(1.75rem, 714.25rem, 6.5rem, 0);
  }
  25% {
    clip: rect(4.75rem, 714.25rem, 2.5rem, 0);
  }
  30% {
    clip: rect(5.75rem, 714.25rem, 0.75rem, 0);
  }
  35% {
    clip: rect(1.25rem, 714.25rem, 7rem, 0);
  }
  40% {
    clip: rect(6.75rem, 714.25rem, 4.75rem, 0);
  }
  45% {
    clip: rect(3.75rem, 714.25rem, 5.75rem, 0);
  }
  50% {
    clip: rect(2.75rem, 714.25rem, 1.75rem, 0);
  }
  100% {
    clip: rect(5.75rem, 714.25rem, 2rem, 0);
  }
}

@keyframes glitch-skew {
  0% {
    transform: skew(0deg);
  }
  10% {
    transform: skew(2deg);
  }
  20% {
    transform: skew(-1deg);
  }
  30% {
    transform: skew(3deg);
  }
  40% {
    transform: skew(-2deg);
  }
  50% {
    transform: skew(1deg);
  }
  60% {
    transform: skew(-3deg);
  }
  70% {
    transform: skew(2deg);
  }
  80% {
    transform: skew(-1deg);
  }
  90% {
    transform: skew(1deg);
  }
  100% {
    transform: skew(0deg);
  }
}

// Pixel borders
@mixin pixel-border($color: vars.$matrix-green, $width: 2px) {
  border: $width solid $color;
  box-shadow:
    inset 0 0 0 $width color.adjust($color, $lightness: -20%),
    inset $width $width 0 0 color.adjust($color, $lightness: 10%),
    inset (-$width) (-$width) 0 0 color.adjust($color, $lightness: -30%);
}

// Hologram effect
@mixin hologram {
  animation: hologram-flicker 0.2s infinite;
  background: linear-gradient(
    180deg,
    rgba(vars.$matrix-green, 0.1) 0%,
    rgba(vars.$matrix-cyan, 0.05) 50%,
    rgba(vars.$matrix-green, 0.1) 100%
  );
  background-size: 100% 200%;
  animation: hologram-scan 3s linear infinite;
}

@keyframes hologram-flicker {
  0%,
  100% {
    opacity: 0.95;
  }
  50% {
    opacity: 0.85;
  }
}

@keyframes hologram-scan {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 0% 200%;
  }
}
