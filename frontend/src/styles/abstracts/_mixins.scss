@use "sass:math";
@use "sass:color";
@use "./variables" as vars;

// CRT Monitor Effect - Scanlines + Phosphor Glow + Chromatic Aberration
@mixin crt-screen {
  position: relative;

  &::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: vars.$z-scanlines;

    // Scanlines
    background: repeating-linear-gradient(
      0deg,
      rgba(vars.$matrix-black, 0.15) 0px,
      transparent 1px,
      transparent 2px,
      rgba(vars.$matrix-black, 0.15) 3px
    );

    // Chromatic aberration
    background-image: repeating-linear-gradient(
        0deg,
        rgba(vars.$matrix-black, 0.15) 0px,
        transparent 1px,
        transparent 2px
      ),
      linear-gradient(
        90deg,
        rgba(255, 0, 0, 0.03),
        rgba(0, 255, 0, 0.02),
        rgba(0, 0, 255, 0.03)
      );
    background-size:
      100% 3px,
      3px 100%;

    animation:
      crt-flicker vars.$flicker-speed infinite alternate,
      crt-scan 8s linear infinite;
  }

  &::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: vars.$z-scanlines - 1;
    background: radial-gradient(
      ellipse at center,
      rgba(vars.$matrix-green, 0.05) 0%,
      transparent 70%
    );
    animation: phosphor-glow 3s ease-in-out infinite alternate;
  }
}

@keyframes crt-flicker {
  0% {
    opacity: 0.95;
  }
  100% {
    opacity: 0.98;
  }
}

@keyframes crt-scan {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 0 100%;
  }
}

@keyframes phosphor-glow {
  0% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.5;
  }
  100% {
    opacity: 0.3;
  }
}

// Text glow effect
@mixin text-glow($color: vars.$matrix-green, $intensity: 10px) {
  text-shadow:
    0 0 math.div($intensity, 4) $color,
    0 0 math.div($intensity, 2) $color,
    0 0 $intensity $color,
    0 0 $intensity * 2 rgba($color, 0.5);
  color: $color;
}

// Box glow effect
@mixin box-glow($color: vars.$matrix-green, $intensity: 20px) {
  box-shadow:
    0 0 math.div($intensity, 4) $color,
    0 0 math.div($intensity, 2) $color,
    0 0 $intensity $color,
    inset 0 0 math.div($intensity, 2) rgba($color, 0.2);
  border: 2px solid $color;
}

// Glitch effect
@mixin glitch-text {
  position: relative;
  animation: glitch-skew 0.5s infinite;

  &::before,
  &::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  &::before {
    left: 2px;
    text-shadow: -2px 0 vars.$matrix-red;
    clip: rect(44px, 450px, 56px, 0);
    animation: glitch-anim 5s infinite linear alternate-reverse;
  }

  &::after {
    left: -2px;
    text-shadow: -2px 0 vars.$matrix-cyan;
    clip: rect(44px, 450px, 56px, 0);
    animation: glitch-anim 3s infinite linear alternate-reverse;
  }
}

@keyframes glitch-anim {
  0% {
    clip: rect(10px, 9999px, 31px, 0);
  }
  5% {
    clip: rect(70px, 9999px, 71px, 0);
  }
  10% {
    clip: rect(60px, 9999px, 68px, 0);
  }
  15% {
    clip: rect(86px, 9999px, 42px, 0);
  }
  20% {
    clip: rect(26px, 9999px, 89px, 0);
  }
  25% {
    clip: rect(68px, 9999px, 35px, 0);
  }
  30% {
    clip: rect(79px, 9999px, 12px, 0);
  }
  35% {
    clip: rect(17px, 9999px, 99px, 0);
  }
  40% {
    clip: rect(94px, 9999px, 65px, 0);
  }
  45% {
    clip: rect(52px, 9999px, 80px, 0);
  }
  50% {
    clip: rect(40px, 9999px, 23px, 0);
  }
  100% {
    clip: rect(82px, 9999px, 27px, 0);
  }
}

@keyframes glitch-skew {
  0% {
    transform: skew(0deg);
  }
  10% {
    transform: skew(2deg);
  }
  20% {
    transform: skew(-1deg);
  }
  30% {
    transform: skew(3deg);
  }
  40% {
    transform: skew(-2deg);
  }
  50% {
    transform: skew(1deg);
  }
  60% {
    transform: skew(-3deg);
  }
  70% {
    transform: skew(2deg);
  }
  80% {
    transform: skew(-1deg);
  }
  90% {
    transform: skew(1deg);
  }
  100% {
    transform: skew(0deg);
  }
}

// Pixel borders
@mixin pixel-border($color: vars.$matrix-green, $width: 2px) {
  border: $width solid $color;
  box-shadow:
    inset 0 0 0 $width color.adjust($color, $lightness: -20%),
    inset $width $width 0 0 color.adjust($color, $lightness: 10%),
    inset (-$width) (-$width) 0 0 color.adjust($color, $lightness: -30%);
}

// Hologram effect
@mixin hologram {
  animation: hologram-flicker 0.2s infinite;
  background: linear-gradient(
    180deg,
    rgba(vars.$matrix-green, 0.1) 0%,
    rgba(vars.$matrix-cyan, 0.05) 50%,
    rgba(vars.$matrix-green, 0.1) 100%
  );
  background-size: 100% 200%;
  animation: hologram-scan 3s linear infinite;
}

@keyframes hologram-flicker {
  0%,
  100% {
    opacity: 0.95;
  }
  50% {
    opacity: 0.85;
  }
}

@keyframes hologram-scan {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 0% 200%;
  }
}
